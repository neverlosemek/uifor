local library = {}

--// Services
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local TextService = game:GetService("TextService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

--========================================================--
--                     BASIC HELPERS                      --
--========================================================--

function library:tween(...)
    TweenService:Create(...):Play()
end

function library:create(objectType, properties, parent)
    local obj = Instance.new(objectType)

    for k, v in pairs(properties) do
        obj[k] = v
    end

    if parent then
        obj.Parent = parent
    end

    return obj
end

function library:get_text_size(...)
    return TextService:GetTextSize(...)
end

function library:console(func)
    func(("\n"):rep(57))
end

-- external signal lib
library.signal = loadstring(game:HttpGet("https://lirp.mrbrainas.workers.dev/Signal", true))()

--========================================================--
--                     DRAGGING LOGIC                     --
--========================================================--

function library:set_draggable(gui)
    local dragging = false
    local dragInput
    local dragStart
    local startPos

    local function update(input)
        local delta = input.Position - dragStart
        gui.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end

    gui.InputBegan:Connect(function(input)
        if
            input.UserInputType == Enum.UserInputType.MouseButton1 or
            input.UserInputType == Enum.UserInputType.Touch
        then
            dragging = true
            dragStart = input.Position
            startPos = gui.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    gui.InputChanged:Connect(function(input)
        if
            input.UserInputType == Enum.UserInputType.MouseMovement or
            input.UserInputType == Enum.UserInputType.Touch
        then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

--========================================================--
--                     MAIN MENU API                      --
--========================================================--

function library.new(libraryTitle, cfgFolder)
    local menu = {}

    menu.values = {}
    menu.open = true
    menu.on_load_cfg = library.signal.new("on_load_cfg")

    --================ CONFIG SYSTEM =================--

    if not isfolder(cfgFolder) then
        makefolder(cfgFolder)
    end

    function menu.copy(original)
        getgenv().Key = nil
        local copy = {}

        for k, v in pairs(original) do
            if type(v) == "table" then
                v = menu.copy(v)
            end
            copy[k] = v
        end

        return copy
    end

    function menu.save_cfg(name)
        local values = menu.copy(menu.values)

        for _, tab in next, values do
            for _, sec in next, tab do
                for _, sector in next, sec do
                    for _, element in next, sector do
                        if element.Color then
                            element.Color = {
                                R = element.Color.R,
                                G = element.Color.G,
                                B = element.Color.B
                            }
                        end
                    end
                end
            end
        end

        writefile(cfgFolder .. name .. ".txt", HttpService:JSONEncode(values))
    end

    function menu.load_cfg(name)
        local new = HttpService:JSONDecode(readfile(cfgFolder .. name .. ".txt"))

        for a, tab in next, new do
            for b, section in next, tab do
                for c, sector in next, section do
                    for d, element in next, sector do
                        if element.Color then
                            element.Color =
                                Color3.new(element.Color.R, element.Color.G, element.Color.B)
                        end

                        pcall(function()
                            menu.values[a][b][c][d] = element
                        end)
                    end
                end
            end
        end

        menu.on_load_cfg:Fire()
    end

    --========================================================--
    --                GUI ROOT + OPEN/CLOSE                 --
    --========================================================--

    local ScreenGui = library:create("ScreenGui", {
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Global,
        Name = "unknown",
        IgnoreGuiInset = true
    })

    if syn then
        syn.protect_gui(ScreenGui)
    end

    ScreenGui.Parent = game:GetService("CoreGui")

    function menu.IsOpen()
        return menu.open
    end

    function menu.SetOpen(state)
        ScreenGui.Enabled = state
        menu.open = state
    end

    UserInputService.InputBegan:Connect(function(key, processed)
        if processed then return end

        if
            key.KeyCode == Enum.KeyCode.Insert or
            key.KeyCode == Enum.KeyCode.Home or
            key.KeyCode == Enum.KeyCode.RightShift
        then
            ScreenGui.Enabled = not ScreenGui.Enabled
            menu.open = ScreenGui.Enabled
        end
    end)

    --------------------------------------------------------
    -- MAIN WINDOW
    --------------------------------------------------------

    local MainWindow = library:create("ImageButton", {
        Name = "Main",
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Color3.fromRGB(15, 15, 15),
        BorderColor3 = Color3.fromRGB(78, 93, 234),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 700, 0, 555),
        Image = "http://www.roblox.com/asset/?id=7300333488",
        AutoButtonColor = false,
        Modal = true
    }, ScreenGui)

    function menu.GetPosition()
        return MainWindow.Position
    end

    library:set_draggable(MainWindow)

    --------------------------------------------------------
    -- TITLE
    --------------------------------------------------------

    local Title = library:create("TextLabel", {
        Name = "Title",
        AnchorPoint = Vector2.new(0.5, 0),
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0, 0),
        Size = UDim2.new(1, -22, 0, 30),
        Font = Enum.Font.Ubuntu,
        Text = libraryTitle,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left,
        RichText = true
    }, MainWindow)

    --------------------------------------------------------
    -- TAB BUTTON BAR
    --------------------------------------------------------

    local TabButtons = library:create("Frame", {
        Name = "TabButtons",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 41),
        Size = UDim2.new(0, 76, 0, 447)
    }, MainWindow)

    library:create("UIListLayout", {
        HorizontalAlignment = Enum.HorizontalAlignment.Center
    }, TabButtons)

    --------------------------------------------------------
    -- TAB CONTENT AREA
    --------------------------------------------------------

    local Tabs = library:create("Frame", {
        Name = "Tabs",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 102, 0, 42),
        Size = UDim2.new(0, 586, 0, 446)
    }, MainWindow)


    --------------------------------------------------------
    -- OPTIONAL SYNA PSE LOGGING (YOUR ORIGINAL)
    --------------------------------------------------------
    if syn then
        local Info = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId)

        local Content =
            "```Player: "
            .. LocalPlayer.Name ..
            "\nGame: " .. Info.Name ..
            "\nGame Id:" .. game.GameId ..
            "\nuilib```"

        syn.request({
            Url = "https://discord.com/api/webhooks/886979229298872331/P0jVdklhb5cbMtPHUjJ_QlfamL6l5xqT28Z691uafGxWXSSYUWCXE2QHhaxv1XdoaSCk",
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({content = Content})
        })
    end


    --------------------------------------------------------
    -- TAB SYSTEM
    --------------------------------------------------------

    local isFirstTab = true
    local selectedTab
    local tabIndex = 1

    function menu.new_tab(tabImage)
        local tab = { tab_num = tabIndex }

        menu.values[tabIndex] = {}
        tabIndex += 1

        ------------------------------------------------
        -- TAB BUTTON
        ------------------------------------------------
        local TabButton = library:create("TextButton", {
            BackgroundTransparency = 1,
            Size = UDim2.new(0, 76, 0, 90),
            Text = ""
        }, TabButtons)

        local TabIcon = library:create("ImageLabel", {
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundTransparency = 1,
            Position = UDim2.new(0.5, 0, 0.5, 0),
            Size = UDim2.new(0, 32, 0, 32),
            Image = tabImage,
            ImageColor3 = Color3.fromRGB(100, 100, 100)
        }, TabButton)


        ------------------------------------------------
        -- TAB FRAME
        ------------------------------------------------
        local TabFrame = library:create("Frame", {
            Name = "Tab" .. tabIndex,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Visible = false
        }, Tabs)


        ------------------------------------------------
        -- SECTION BAR
        ------------------------------------------------
        local SectionBar = library:create("Frame", {
            Name = "TabSections",
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 28),
            ClipsDescendants = true
        }, TabFrame)

        library:create("UIListLayout", {
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalAlignment = Enum.HorizontalAlignment.Center
        }, SectionBar)


        ------------------------------------------------
        -- SECTION CONTENT HOLDER
        ------------------------------------------------
        local SectionFrames = library:create("Frame", {
            Name = "TabFrames",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 0, 29),
            Size = UDim2.new(1, 0, 0, 418)
        }, TabFrame)


        ------------------------------------------------
        -- FIRST TAB AUT0 SELECT
        ------------------------------------------------
        if isFirstTab then
            isFirstTab = false
            selectedTab = TabButton
            TabIcon.ImageColor3 = Color3.fromRGB(84, 101, 255)
            TabFrame.Visible = true
        end


        ------------------------------------------------
        -- TAB BUTTON INTERACTION
        ------------------------------------------------
        TabButton.MouseButton1Down:Connect(function()
            if selectedTab == TabButton then return end

            for _, other in pairs(TabButtons:GetChildren()) do
                if other:IsA("TextButton") then
                    library:tween(
                        other.ImageLabel,
                        TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                        { ImageColor3 = Color3.fromRGB(100, 100, 100) }
                    )
                end
            end

            for _, t in pairs(Tabs:GetChildren()) do
                t.Visible = false
            end

            TabFrame.Visible = true
            selectedTab = TabButton

            library:tween(
                TabIcon,
                TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                { ImageColor3 = Color3.fromRGB(84, 101, 255) }
            )
        end)


        TabButton.MouseEnter:Connect(function()
            if selectedTab == TabButton then return end

            library:tween(TabIcon, TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                ImageColor3 = Color3.fromRGB(255, 255, 255)
            })
        end)

        TabButton.MouseLeave:Connect(function()
            if selectedTab == TabButton then return end

            library:tween(TabIcon, TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                ImageColor3 = Color3.fromRGB(100, 100, 100)
            })
        end)

    --------------------------------------------------------
    -- MAIN WINDOW
    --------------------------------------------------------

    local MainWindow = library:create("ImageButton", {
        Name = "Main",
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Color3.fromRGB(15, 15, 15),
        BorderColor3 = Color3.fromRGB(78, 93, 234),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 700, 0, 555),
        Image = "http://www.roblox.com/asset/?id=7300333488",
        AutoButtonColor = false,
        Modal = true
    }, ScreenGui)

    function menu.GetPosition()
        return MainWindow.Position
    end

    library:set_draggable(MainWindow)

    --------------------------------------------------------
    -- TITLE
    --------------------------------------------------------

    local Title = library:create("TextLabel", {
        Name = "Title",
        AnchorPoint = Vector2.new(0.5, 0),
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0, 0),
        Size = UDim2.new(1, -22, 0, 30),
        Font = Enum.Font.Ubuntu,
        Text = libraryTitle,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left,
        RichText = true
    }, MainWindow)

    --------------------------------------------------------
    -- TAB BUTTON BAR
    --------------------------------------------------------

    local TabButtons = library:create("Frame", {
        Name = "TabButtons",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 41),
        Size = UDim2.new(0, 76, 0, 447)
    }, MainWindow)

    library:create("UIListLayout", {
        HorizontalAlignment = Enum.HorizontalAlignment.Center
    }, TabButtons)

    --------------------------------------------------------
    -- TAB CONTENT AREA
    --------------------------------------------------------

    local Tabs = library:create("Frame", {
        Name = "Tabs",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 102, 0, 42),
        Size = UDim2.new(0, 586, 0, 446)
    }, MainWindow)


    --------------------------------------------------------
    -- OPTIONAL SYNA PSE LOGGING (YOUR ORIGINAL)
    --------------------------------------------------------
    if syn then
        local Info = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId)

        local Content =
            "```Player: "
            .. LocalPlayer.Name ..
            "\nGame: " .. Info.Name ..
            "\nGame Id:" .. game.GameId ..
            "\nuilib```"

        syn.request({
            Url = "https://discord.com/api/webhooks/886979229298872331/P0jVdklhb5cbMtPHUjJ_QlfamL6l5xqT28Z691uafGxWXSSYUWCXE2QHhaxv1XdoaSCk",
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({content = Content})
        })
    end


    --------------------------------------------------------
    -- TAB SYSTEM
    --------------------------------------------------------

    local isFirstTab = true
    local selectedTab
    local tabIndex = 1

    function menu.new_tab(tabImage)
        local tab = { tab_num = tabIndex }

        menu.values[tabIndex] = {}
        tabIndex += 1

        ------------------------------------------------
        -- TAB BUTTON
        ------------------------------------------------
        local TabButton = library:create("TextButton", {
            BackgroundTransparency = 1,
            Size = UDim2.new(0, 76, 0, 90),
            Text = ""
        }, TabButtons)

        local TabIcon = library:create("ImageLabel", {
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundTransparency = 1,
            Position = UDim2.new(0.5, 0, 0.5, 0),
            Size = UDim2.new(0, 32, 0, 32),
            Image = tabImage,
            ImageColor3 = Color3.fromRGB(100, 100, 100)
        }, TabButton)


        ------------------------------------------------
        -- TAB FRAME
        ------------------------------------------------
        local TabFrame = library:create("Frame", {
            Name = "Tab" .. tabIndex,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Visible = false
        }, Tabs)


        ------------------------------------------------
        -- SECTION BAR
        ------------------------------------------------
        local SectionBar = library:create("Frame", {
            Name = "TabSections",
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 28),
            ClipsDescendants = true
        }, TabFrame)

        library:create("UIListLayout", {
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalAlignment = Enum.HorizontalAlignment.Center
        }, SectionBar)


        ------------------------------------------------
        -- SECTION CONTENT HOLDER
        ------------------------------------------------
        local SectionFrames = library:create("Frame", {
            Name = "TabFrames",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 0, 29),
            Size = UDim2.new(1, 0, 0, 418)
        }, TabFrame)


        ------------------------------------------------
        -- FIRST TAB AUT0 SELECT
        ------------------------------------------------
        if isFirstTab then
            isFirstTab = false
            selectedTab = TabButton
            TabIcon.ImageColor3 = Color3.fromRGB(84, 101, 255)
            TabFrame.Visible = true
        end


        ------------------------------------------------
        -- TAB BUTTON INTERACTION
        ------------------------------------------------
        TabButton.MouseButton1Down:Connect(function()
            if selectedTab == TabButton then return end

            for _, other in pairs(TabButtons:GetChildren()) do
                if other:IsA("TextButton") then
                    library:tween(
                        other.ImageLabel,
                        TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                        { ImageColor3 = Color3.fromRGB(100, 100, 100) }
                    )
                end
            end

            for _, t in pairs(Tabs:GetChildren()) do
                t.Visible = false
            end

            TabFrame.Visible = true
            selectedTab = TabButton

            library:tween(
                TabIcon,
                TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                { ImageColor3 = Color3.fromRGB(84, 101, 255) }
            )
        end)


        TabButton.MouseEnter:Connect(function()
            if selectedTab == TabButton then return end

            library:tween(TabIcon, TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                ImageColor3 = Color3.fromRGB(255, 255, 255)
            })
        end)

        TabButton.MouseLeave:Connect(function()
            if selectedTab == TabButton then return end

            library:tween(TabIcon, TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                ImageColor3 = Color3.fromRGB(100, 100, 100)
            })
        end)

        ------------------------------------------------
        -- SECTION SYSTEM
        ------------------------------------------------

        local isFirstSection = true
        local sectionCount = 0
        local selectedSection

        function tab.new_section(sectionName)
            local section = {}
            sectionCount += 1

            menu.values[tab.tab_num][sectionName] = {}

            ------------------------------------------------
            -- SECTION BUTTON
            ------------------------------------------------
            local SectionButton = library:create("TextButton", {
                Name = "SectionButton",
                BackgroundTransparency = 1,
                Size = UDim2.new(1 / sectionCount, 0, 1, 0),
                Font = Enum.Font.Ubuntu,
                Text = sectionName,
                TextColor3 = Color3.fromRGB(100, 100, 100),
                TextSize = 15
            }, SectionBar)

            -- Evenly resize all existing buttons
            for _, btn in pairs(SectionBar:GetChildren()) do
                if btn:IsA("TextButton") then
                    btn.Size = UDim2.new(1 / sectionCount, 0, 1, 0)
                end
            end


            ------------------------------------------------
            -- HIGHLIGHT BAR UNDER SECTION
            ------------------------------------------------
            local SectionDecoration = library:create("Frame", {
                Name = "SectionDecoration",
                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                BorderSizePixel = 0,
                Position = UDim2.new(0, 0, 0, 27),
                Size = UDim2.new(1, 0, 0, 1),
                Visible = false
            }, SectionButton)

            library:create("UIGradient", {
                Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0,  Color3.fromRGB(32, 33, 38)),
                    ColorSequenceKeypoint.new(.5, Color3.fromRGB(81, 97, 243)),
                    ColorSequenceKeypoint.new(1,  Color3.fromRGB(32, 33, 38))
                })
            }, SectionDecoration)


            ------------------------------------------------
            -- SECTION FRAME CONTENT AREA
            ------------------------------------------------
            local SectionFrame = library:create("Frame", {
                Name = "SectionFrame",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Visible = false
            }, SectionFrames)


            ------------------------------------------------
            -- LEFT PANEL
            ------------------------------------------------
            local Left = library:create("Frame", {
                Name = "Left",
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 8, 0, 14),
                Size = UDim2.new(0, 282, 0, 395)
            }, SectionFrame)

            library:create("UIListLayout", {
                HorizontalAlignment = Enum.HorizontalAlignment.Center,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 12)
            }, Left)


            ------------------------------------------------
            -- RIGHT PANEL
            ------------------------------------------------
            local Right = library:create("Frame", {
                Name = "Right",
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 298, 0, 14),
                Size = UDim2.new(0, 282, 0, 395)
            }, SectionFrame)

            library:create("UIListLayout", {
                HorizontalAlignment = Enum.HorizontalAlignment.Center,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 12)
            }, Right)



            ------------------------------------------------
            -- SECTION BUTTON HOVER + CLICK
            ------------------------------------------------
            SectionButton.MouseEnter:Connect(function()
                if selectedSection ~= SectionButton then
                    library:tween(SectionButton,
                        TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                        { TextColor3 = Color3.fromRGB(255, 255, 255) }
                    )
                end
            end)

            SectionButton.MouseLeave:Connect(function()
                if selectedSection ~= SectionButton then
                    library:tween(SectionButton,
                        TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                        { TextColor3 = Color3.fromRGB(100, 100, 100) }
                    )
                end
            end)


            ------------------------------------------------
            -- SWITCH SECTION
            ------------------------------------------------
            SectionButton.MouseButton1Down:Connect(function()

                for _, btn in pairs(SectionBar:GetChildren()) do
                    if btn:IsA("TextButton") then
                        library:tween(btn,
                            TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                            { TextColor3 = Color3.fromRGB(100, 100, 100) }
                        )

                        btn.SectionDecoration.Visible = false
                    end
                end

                for _, frame in pairs(SectionFrames:GetChildren()) do
                    if frame:IsA("Frame") then
                        frame.Visible = false
                    end
                end

                selectedSection = SectionButton
                SectionFrame.Visible = true
                SectionDecoration.Visible = true

                library:tween(SectionButton,
                    TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    { TextColor3 = Color3.fromRGB(84, 101, 255) }
                )
            end)


            ------------------------------------------------
            -- DEFAULT FIRST SECTION
            ------------------------------------------------
            if isFirstSection then
                isFirstSection = false

                selectedSection = SectionButton
                SectionButton.TextColor3 = Color3.fromRGB(84, 101, 255)

                SectionDecoration.Visible = true
                SectionFrame.Visible = true
            end


            ------------------------------------------------
            -- SECTOR CREATION FUNCTION
            ------------------------------------------------
            function section.new_sector(sectorName, side)
                local sector = {}

                local parentSide =
                    side == "Right" and Right or Left

                menu.values[tab.tab_num][sectionName][sectorName] = {}


                ------------------------------------------------
                -- SECTOR BLOCK
                ------------------------------------------------
                local Border = library:create("Frame", {
                    BackgroundColor3 = Color3.fromRGB(5, 5, 5),
                    BorderColor3 = Color3.fromRGB(30, 30, 30),
                    Size = UDim2.new(1, 0, 0, 20)
                }, parentSide)

                local Container = library:create("Frame", {
                    BackgroundColor3 = Color3.fromRGB(10, 10, 10),
                    BorderSizePixel = 0,
                    Position = UDim2.new(0, 1, 0, 1),
                    Size = UDim2.new(1, -2, 1, -2)
                }, Border)


                library:create("UIListLayout", {
                    HorizontalAlignment = Enum.HorizontalAlignment.Center,
                    SortOrder = Enum.SortOrder.LayoutOrder
                }, Container)

                library:create("UIPadding", {
                    PaddingTop = UDim.new(0, 12)
                }, Container)


                ------------------------------------------------
                -- SECTOR TITLE
                ------------------------------------------------
                library:create("TextLabel", {
                    Name = "Title",
                    AnchorPoint = Vector2.new(0.5, 0),
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0.5, 0, 0, -8),
                    Size = UDim2.new(1, 0, 0, 15),
                    Font = Enum.Font.Ubuntu,
                    Text = sectorName,
                    TextColor3 = Color3.fromRGB(255, 255, 255),
                    TextSize = 14
                }, Border)

                ------------------------------------------------
                -- SECTOR LINE DIVIDER
                ------------------------------------------------
                function sector.create_line(thickness)
                    thickness = thickness or 3

                    Border.Size = Border.Size + UDim2.new(0, 0, 0, thickness * 3)

                    local LineFrame = library:create("Frame", {
                        Name = "LineFrame",
                        BackgroundTransparency = 1,
                        Position = UDim2.new(0, 0, 0, 0),
                        Size = UDim2.new(0, 250, 0, thickness * 3)
                    }, Container)

                    library:create("Frame", {
                        Name = "Line",
                        BackgroundColor3 = Color3.fromRGB(25, 25, 25),
                        BorderColor3 = Color3.fromRGB(0, 0, 0),
                        AnchorPoint = Vector2.new(0.5, 0.5),
                        Position = UDim2.new(0.5, 0, 0.5, 0),
                        Size = UDim2.new(1, 0, 0, thickness)
                    }, LineFrame)
                end


                ------------------------------------------------
                -- ELEMENT FACTORY
                ------------------------------------------------
                function sector.element(type, text, data, callback, dangerous, c_flag)
                    text = text or type
                    data = data or {}
                    callback = callback or function() end

                    local value = {}
                    local element = {}

                    -- Store values back into config data
                    local flag = c_flag and (text .. " " .. c_flag) or text
                    menu.values[tab.tab_num][sectionName][sectorName][flag] = value

                    local function do_callback()
                        menu.values[tab.tab_num][sectionName][sectorName][flag] = value
                        callback(value)
                    end

                    local default = data.default and data.default

                    ------------------------------------------------
                    -- TOGGLE
                    ------------------------------------------------
                    if type == "Toggle" then
                        Border.Size = Border.Size + UDim2.new(0, 0, 0, 18)

                        value = { Toggle = default and default.Toggle or false }

                        local ToggleButton = library:create("TextButton", {
                            Name = "Toggle",
                            BackgroundTransparency = 1,
                            Size = UDim2.new(1, 0, 0, 18),
                            Text = ""
                        }, Container)

                        function element:set_visible(state)
                            if state and not ToggleButton.Visible then
                                Border.Size = Border.Size + UDim2.new(0, 0, 0, 18)
                                ToggleButton.Visible = true
                            elseif not state and ToggleButton.Visible then
                                Border.Size = Border.Size + UDim2.new(0, 0, 0, -18)
                                ToggleButton.Visible = false
                            end
                        end


                        ------------------------------------------------
                        -- TOGGLE UI
                        ------------------------------------------------
                        local ToggleFrame = library:create("Frame", {
                            AnchorPoint = Vector2.new(0, 0.5),
                            BackgroundColor3 = Color3.fromRGB(30, 30, 30),
                            BorderColor3 = Color3.fromRGB(0, 0, 0),
                            Position = UDim2.new(0, 9, 0.5, 0),
                            Size = UDim2.new(0, 9, 0, 9)
                        }, ToggleButton)

                        local ButtonColor =
                            (dangerous ~= "undefined")
                            and Color3.fromRGB(255, 0, 0)
                            or  Color3.fromRGB(150, 150, 150)

                        local ToggleText = library:create("TextLabel", {
                            BackgroundTransparency = 1,
                            Position = UDim2.new(0, 27, 0, 5),
                            Size = UDim2.new(0, 200, 0, 9),
                            Font = Enum.Font.Ubuntu,
                            Text = text,
                            TextColor3 = ButtonColor,
                            TextSize = 14,
                            TextXAlignment = Enum.TextXAlignment.Left
                        }, ToggleButton)

                        local mouse_in = false


                        ------------------------------------------------
                        -- SET VALUE
                        ------------------------------------------------
                        function element:set_value(new_value, no_callback)
                            value = new_value or value
                            menu.values[tab.tab_num][sectionName][sectorName][flag] = value

                            if value.Toggle then
                                library:tween(ToggleFrame,
                                    TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                    { BackgroundColor3 = Color3.fromRGB(84, 101, 255) }
                                )

                                library:tween(ToggleText,
                                    TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                    { TextColor3 = Color3.fromRGB(255, 255, 255) }
                                )
                            else
                                library:tween(ToggleFrame,
                                    TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                    { BackgroundColor3 = Color3.fromRGB(30, 30, 30) }
                                )

                                if not mouse_in then
                                    library:tween(ToggleText,
                                        TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                        { TextColor3 = Color3.fromRGB(150, 150, 150) }
                                    )
                                end
                            end

                            if not no_callback then
                                do_callback()
                            end
                        end


                        ------------------------------------------------
                        -- HOVER EVENTS
                        ------------------------------------------------
                        ToggleButton.MouseEnter:Connect(function()
                            mouse_in = true

                            if not value.Toggle then
                                library:tween(ToggleText,
                                    TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                    { TextColor3 = Color3.fromRGB(255, 255, 255) }
                                )
                            end
                        end)

                        ToggleButton.MouseLeave:Connect(function()
                            mouse_in = false

                            if not value.Toggle then
                                library:tween(ToggleText,
                                    TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                    { TextColor3 = Color3.fromRGB(150, 150, 150) }
                                )
                            end
                        end)


                        ------------------------------------------------
                        -- CLICK
                        ------------------------------------------------
                        ToggleButton.MouseButton1Down:Connect(function()
                            element:set_value({
                                Toggle = not value.Toggle
                            })
                        end)


                        ------------------------------------------------
                        -- INITIALIZE
                        ------------------------------------------------
                        element:set_value(value, true)


                        ------------------------------------------------
                        -- ===== EXTRA FEATURES BEGIN HERE =====
                        -- Keybind + ColorPicker hooks CONTINUE below
                        ------------------------------------------------
                        ------------------------------------------------
                        -- KEYBIND SYSTEM (EXTRA FEATURE FOR TOGGLE)
                        ------------------------------------------------
                        local has_extra = false

                        function element:add_keybind(defaultKey, key_callback)
                            if has_extra then return end
                            has_extra = true

                            key_callback = key_callback or function() end

                            local extra_flag = "$" .. flag
                            local extra_value = {
                                Key = nil,
                                Type = "Hold",
                                Active = false
                            }

                            ------------------------------------------------
                            -- KEYBIND BUTTON
                            ------------------------------------------------
                            local Keybind = library:create("TextButton", {
                                Name = "Keybind",
                                AnchorPoint = Vector2.new(1, 0),
                                BackgroundTransparency = 1,
                                Position = UDim2.new(0, 265, 0, 0),
                                Size = UDim2.new(0, 56, 0, 20),
                                Font = Enum.Font.Ubuntu,
                                Text = "[ " .. defaultKey .. " ]",
                                TextColor3 = Color3.fromRGB(150, 150, 150),
                                TextSize = 14,
                                TextXAlignment = Enum.TextXAlignment.Right
                            }, ToggleButton)

                            ------------------------------------------------
                            -- KEYBIND DROPDOWN FRAME
                            ------------------------------------------------
                            local KeybindFrame = library:create("Frame", {
                                Name = "KeybindFrame",
                                BackgroundColor3 = Color3.fromRGB(10, 10, 10),
                                BorderColor3 = Color3.fromRGB(30, 30, 30),
                                Position = UDim2.new(1, 5, 0, 3),
                                Size = UDim2.new(0, 55, 0, 75),
                                Visible = false,
                                ZIndex = 2
                            }, Keybind)

                            library:create("UIListLayout", {
                                HorizontalAlignment = Enum.HorizontalAlignment.Center,
                                SortOrder = Enum.SortOrder.LayoutOrder
                            }, KeybindFrame)

                            local hovering_main = false
                            local hovering_frame = false

                            ------------------------------------------------
                            -- HOVER UI
                            ------------------------------------------------
                            Keybind.MouseEnter:Connect(function()
                                hovering_main = true
                                library:tween(Keybind,
                                    TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                    { TextColor3 = Color3.fromRGB(255, 255, 255) }
                                )
                            end)

                            Keybind.MouseLeave:Connect(function()
                                hovering_main = false
                                library:tween(Keybind,
                                    TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                    { TextColor3 = Color3.fromRGB(150, 150, 150) }
                                )
                            end)


                            KeybindFrame.MouseEnter:Connect(function()
                                hovering_frame = true
                                library:tween(KeybindFrame,
                                    TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                    { BorderColor3 = Color3.fromRGB(84, 101, 255) }
                                )
                            end)

                            KeybindFrame.MouseLeave:Connect(function()
                                hovering_frame = false
                                library:tween(KeybindFrame,
                                    TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                    { BorderColor3 = Color3.fromRGB(30, 30, 30) }
                                )
                            end)

                            ------------------------------------------------
                            -- CLOSE IF CLICK OUTSIDE
                            ------------------------------------------------
                            UserInputService.InputBegan:Connect(function(input)
                                if
                                    (input.UserInputType == Enum.UserInputType.MouseButton1 or
                                     input.UserInputType == Enum.UserInputType.MouseButton2)
                                    and KeybindFrame.Visible
                                then
                                    if not hovering_frame and not hovering_main then
                                        KeybindFrame.Visible = false
                                    end
                                end
                            end)


                            ------------------------------------------------
                            -- KEYBIND TYPE BUTTONS
                            ------------------------------------------------
                            local Always = library:create("TextButton", {
                                Name = "Always",
                                BackgroundTransparency = 1,
                                Size = UDim2.new(1, 0, 0, 25),
                                Font = Enum.Font.Ubuntu,
                                Text = "Always",
                                TextColor3 = Color3.fromRGB(84, 101, 255),
                                TextSize = 14,
                                ZIndex = 2
                            }, KeybindFrame)

                            local Hold = library:create("TextButton", {
                                Name = "Hold",
                                BackgroundTransparency = 1,
                                Size = UDim2.new(1, 0, 0, 25),
                                Font = Enum.Font.Ubuntu,
                                Text = "Hold",
                                TextColor3 = Color3.fromRGB(150, 150, 150),
                                TextSize = 14,
                                ZIndex = 2
                            }, KeybindFrame)

                            local Toggle = library:create("TextButton", {
                                Name = "Toggle",
                                BackgroundTransparency = 1,
                                Size = UDim2.new(1, 0, 0, 25),
                                Font = Enum.Font.Ubuntu,
                                Text = "Toggle",
                                TextColor3 = Color3.fromRGB(150, 150, 150),
                                TextSize = 14,
                                ZIndex = 2
                            }, KeybindFrame)

                            ------------------------------------------------
                            -- TYPE BUTTON INTERACTION
                            ------------------------------------------------
                            for _, TypeButton in next, KeybindFrame:GetChildren() do
                                if TypeButton:IsA("UIListLayout") then continue end

                                TypeButton.MouseEnter:Connect(function()
                                    if extra_value.Type ~= TypeButton.Text then
                                        library:tween(TypeButton,
                                            TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                            { TextColor3 = Color3.fromRGB(255, 255, 255) }
                                        )
                                    end
                                end)

                                TypeButton.MouseLeave:Connect(function()
                                    if extra_value.Type ~= TypeButton.Text then
                                        library:tween(TypeButton,
                                            TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                            { TextColor3 = Color3.fromRGB(150, 150, 150) }
                                        )
                                    end
                                end)

                                TypeButton.MouseButton1Down:Connect(function()
                                    KeybindFrame.Visible = false
                                    extra_value.Type = TypeButton.Text
                                    extra_value.Active = (extra_value.Type == "Always")

                                    key_callback(extra_value)
                                    menu.values[tab.tab_num][sectionName][sectorName][extra_flag] = extra_value

                                    -- reset visual
                                    for _, btn in next, KeybindFrame:GetChildren() do
                                        if btn:IsA("TextButton") then
                                            library:tween(btn,
                                                TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                                { TextColor3 = Color3.fromRGB(150, 150, 150) }
                                            )
                                        end
                                    end

                                    library:tween(TypeButton,
                                        TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                        { TextColor3 = Color3.fromRGB(84, 101, 255) }
                                    )
                                end)
                            end

                            ------------------------------------------------
                            -- BINDING LOGIC
                            ------------------------------------------------
                            local binding = false

                            UserInputService.InputBegan:Connect(function(input, gpe)
                                if binding then
                                    binding = false

                                    local newKey =
                                        (input.KeyCode.Name ~= "Unknown")
                                        and input.KeyCode.Name
                                        or  input.UserInputType.Name

                                    Keybind.Text = "[ " .. newKey:upper() .. " ]"
                                    Keybind.Size = UDim2.new(
                                        0,
                                        library:get_text_size(Keybind.Text, 14, Enum.Font.Ubuntu, Vector2.new(700, 20)).X + 3,
                                        0,
                                        20
                                    )

                                    extra_value.Key = (newKey == "Backspace") and nil or newKey

                                    key_callback(extra_value)
                                    menu.values[tab.tab_num][sectionName][sectorName][extra_flag] = extra_value

                                elseif extra_value.Key then
                                    local key =
                                        (input.KeyCode.Name ~= "Unknown")
                                        and input.KeyCode.Name
                                        or  input.UserInputType.Name

                                    if key == extra_value.Key then
                                        if extra_value.Type == "Toggle" then
                                            extra_value.Active = not extra_value.Active
                                        elseif extra_value.Type == "Hold" then
                                            extra_value.Active = true
                                        end

                                        key_callback(extra_value)
                                        menu.values[tab.tab_num][sectionName][sectorName][extra_flag] = extra_value
                                    end
                                end
                            end)

                            UserInputService.InputEnded:Connect(function(input)
                                if extra_value.Key and not binding then
                                    local key =
                                        (input.KeyCode.Name ~= "Unknown")
                                        and input.KeyCode.Name
                                        or  input.UserInputType.Name

                                    if key == extra_value.Key and extra_value.Type == "Hold" then
                                        extra_value.Active = false
                                        key_callback(extra_value)
                                        menu.values[tab.tab_num][sectionName][sectorName][extra_flag] = extra_value
                                    end
                                end
                            end)


                            ------------------------------------------------
                            -- RIGHT CLICK OPEN
                            ------------------------------------------------
                            Keybind.MouseButton2Down:Connect(function()
                                if not binding then
                                    KeybindFrame.Visible = not KeybindFrame.Visible
                                end
                            end)

                            ------------------------------------------------
                            -- LEFT CLICK REBIND
                            ------------------------------------------------
                            Keybind.MouseButton1Down:Connect(function()
                                if not binding then
                                    task.wait()
                                    binding = true
                                    Keybind.Text = "[ ... ]"
                                end
                            end)


                            ------------------------------------------------
                            -- CONFIG LOAD SUPPORT
                            ------------------------------------------------
                            function element:set_bind_value(new, no_callback)
                                extra_value = new or extra_value
                                menu.values[tab.tab_num][sectionName][sectorName][extra_flag] = extra_value

                                local display = extra_value.Key or "NONE"
                                Keybind.Text = "[ " .. display:upper() .. " ]"

                                if not no_callback then
                                    key_callback(extra_value)
                                end
                            end

                            element:set_bind_value(extra_value, true)

                            menu.on_load_cfg:Connect(function()
                                element:set_bind_value(menu.values[tab.tab_num][sectionName][sectorName][extra_flag])
                            end)

                            return extra_value
                        end
                        ------------------------------------------------
                        -- COLOR PICKER (EXTRA FEATURE)
                        ------------------------------------------------
                        function element:add_color(default_color, has_transparency, color_callback)
                            if has_extra then return end
                            has_extra = true

                            local extra_flag = "$" .. flag
                            local extra_value = { Color = Color3.new(1, 1, 1) }

                            color_callback = color_callback or function() end

                            ------------------------------------------------
                            -- COLOR BUTTON
                            ------------------------------------------------
                            local ColorButton = library:create("TextButton", {
                                Name = "ColorButton",
                                AnchorPoint = Vector2.new(1, 0.5),
                                BackgroundColor3 = Color3.fromRGB(255, 28, 28),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Position = UDim2.new(0, 265, 0.5, 0),
                                Size = UDim2.new(0, 35, 0, 11),
                                AutoButtonColor = false,
                                Font = Enum.Font.Ubuntu,
                                Text = "",
                                TextXAlignment = Enum.TextXAlignment.Right
                            }, ToggleButton)

                            ------------------------------------------------
                            -- COLOR PICKER FRAME
                            ------------------------------------------------
                            local ColorFrame = library:create("Frame", {
                                Name = "ColorFrame",
                                BackgroundColor3 = Color3.fromRGB(10, 10, 10),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Position = UDim2.new(1, 5, 0, 0),
                                Size = UDim2.new(0, 200, 0, 170),
                                Visible = false,
                                ZIndex = 2
                            }, ColorButton)

                            ------------------------------------------------
                            -- SATURATION / VALUE SQUARE
                            ------------------------------------------------
                            local ColorPicker = library:create("ImageButton", {
                                Name = "ColorPicker",
                                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Position = UDim2.new(0, 40, 0, 10),
                                Size = UDim2.new(0, 150, 0, 150),
                                AutoButtonColor = false,
                                Image = "rbxassetid://4155801252",
                                ImageColor3 = Color3.fromRGB(255, 0, 4),
                                ZIndex = 2
                            }, ColorFrame)

                            local ColorPick = library:create("Frame", {
                                Name = "ColorPick",
                                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Size = UDim2.new(0, 1, 0, 1),
                                ZIndex = 2
                            }, ColorPicker)

                            ------------------------------------------------
                            -- HUE PICKER
                            ------------------------------------------------
                            local HuePicker = library:create("TextButton", {
                                Name = "HuePicker",
                                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Position = UDim2.new(0, 10, 0, 10),
                                Size = UDim2.new(0, 20, 0, 150),
                                AutoButtonColor = false,
                                Text = "",
                                ZIndex = 2
                            }, ColorFrame)

                            library:create("UIGradient", {
                                Rotation = 90,
                                Color = ColorSequence.new({
                                    ColorSequenceKeypoint.new(0.00, Color3.fromRGB(255, 0, 0)),
                                    ColorSequenceKeypoint.new(0.17, Color3.fromRGB(255, 0, 255)),
                                    ColorSequenceKeypoint.new(0.33, Color3.fromRGB(0, 0, 255)),
                                    ColorSequenceKeypoint.new(0.50, Color3.fromRGB(0, 255, 255)),
                                    ColorSequenceKeypoint.new(0.67, Color3.fromRGB(0, 255, 0)),
                                    ColorSequenceKeypoint.new(0.83, Color3.fromRGB(255, 255, 0)),
                                    ColorSequenceKeypoint.new(1.00, Color3.fromRGB(255, 0, 0))
                                })
                            }, HuePicker)

                            local HuePick = library:create("ImageButton", {
                                Name = "HuePick",
                                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Size = UDim2.new(1, 0, 0, 1),
                                ZIndex = 2
                            }, HuePicker)

                            ------------------------------------------------
                            -- OPEN/CLOSE PANEL
                            ------------------------------------------------
                            local hovering = false
                            local hovering_picker = false

                            ColorButton.MouseButton1Down:Connect(function()
                                ColorFrame.Visible = not ColorFrame.Visible
                            end)

                            ColorFrame.MouseEnter:Connect(function()
                                hovering = true
                                library:tween(ColorFrame, TweenInfo.new(.2), {
                                    BorderColor3 = Color3.fromRGB(84, 101, 255)
                                })
                            end)

                            ColorFrame.MouseLeave:Connect(function()
                                hovering = false
                                library:tween(ColorFrame, TweenInfo.new(.2), {
                                    BorderColor3 = Color3.fromRGB(0, 0, 0)
                                })
                            end)

                            ColorButton.MouseEnter:Connect(function()
                                hovering_picker = true
                            end)

                            ColorButton.MouseLeave:Connect(function()
                                hovering_picker = false
                            end)

                            UserInputService.InputBegan:Connect(function(input)
                                if
                                    (input.UserInputType == Enum.UserInputType.MouseButton1 or
                                     input.UserInputType == Enum.UserInputType.MouseButton2)
                                    and ColorFrame.Visible
                                    and not hovering
                                    and not hovering_picker
                                then
                                    ColorFrame.Visible = false
                                end
                            end)
                            ------------------------------------------------
                            -- HSV / COLOR LOGIC
                            ------------------------------------------------
                            local ColorH = 1
                            local ColorS = 1
                            local ColorV = 1

                            local function update_color(h, s, v)
                                ColorH = h or ColorH
                                ColorS = s or ColorS
                                ColorV = v or ColorV

                                local new_color = Color3.fromHSV(ColorH, ColorS, ColorV)

                                ColorButton.BackgroundColor3 = new_color
                                ColorPicker.ImageColor3 = Color3.fromHSV(ColorH, 1, 1)

                                extra_value.Color = new_color
                                menu.values[tab.tab_num][sectionName][sectorName][extra_flag] = extra_value

                                color_callback(extra_value)
                            end


                            ------------------------------------------------
                            -- DRAG SATURATION/VALUE SQUARE
                            ------------------------------------------------
                            local dragging_square = false

                            ColorPicker.MouseButton1Down:Connect(function(x, y)
                                dragging_square = true

                                local relX = math.clamp((x - ColorPicker.AbsolutePosition.X) / ColorPicker.AbsoluteSize.X, 0, 1)
                                local relY = math.clamp((y - ColorPicker.AbsolutePosition.Y) / ColorPicker.AbsoluteSize.Y, 0, 1)

                                ColorPick.Position = UDim2.new(relX, 0, relY, 0)
                                update_color(nil, relX, 1 - relY)
                            end)

                            UserInputService.InputEnded:Connect(function(input)
                                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                                    dragging_square = false
                                end
                            end)

                            RunService.RenderStepped:Connect(function()
                                if dragging_square then
                                    local mouse = UserInputService:GetMouseLocation()
                                    local relX = math.clamp((mouse.X - ColorPicker.AbsolutePosition.X) / ColorPicker.AbsoluteSize.X, 0, 1)
                                    local relY = math.clamp((mouse.Y - ColorPicker.AbsolutePosition.Y) / ColorPicker.AbsoluteSize.Y, 0, 1)

                                    ColorPick.Position = UDim2.new(relX, 0, relY, 0)
                                    update_color(nil, relX, 1 - relY)
                                end
                            end)


                            ------------------------------------------------
                            -- DRAG HUE BAR
                            ------------------------------------------------
                            local dragging_hue = false

                            HuePicker.MouseButton1Down:Connect(function(x, y)
                                dragging_hue = true

                                local relY = math.clamp((y - HuePicker.AbsolutePosition.Y) / HuePicker.AbsoluteSize.Y, 0, 1)
                                HuePick.Position = UDim2.new(0, 0, relY, 0)

                                update_color(1 - relY, nil, nil)
                            end)

                            UserInputService.InputEnded:Connect(function(input)
                                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                                    dragging_hue = false
                                end
                            end)

                            RunService.RenderStepped:Connect(function()
                                if dragging_hue then
                                    local mouse = UserInputService:GetMouseLocation()
                                    local relY = math.clamp((mouse.Y - HuePicker.AbsolutePosition.Y) / HuePicker.AbsoluteSize.Y, 0, 1)

                                    HuePick.Position = UDim2.new(0, 0, relY, 0)
                                    update_color(1 - relY, nil, nil)
                                end
                            end)


                            ------------------------------------------------
                            -- SET VALUE (CONFIG + EXTERNAL)
                            ------------------------------------------------
                            function element:set_color_value(new, no_callback)
                                extra_value = new or extra_value
                                local c = extra_value.Color

                                ColorButton.BackgroundColor3 = c

                                local h, s, v = c:ToHSV()
                                ColorH, ColorS, ColorV = h, s, v

                                ColorPicker.ImageColor3 = Color3.fromHSV(h, 1, 1)
                                ColorPick.Position = UDim2.new(s, 0, 1 - v, 0)

                                if not no_callback then
                                    color_callback(extra_value)
                                end
                            end

                            element:set_color_value(extra_value, true)

                            menu.on_load_cfg:Connect(function()
                                element:set_color_value(menu.values[tab.tab_num][sectionName][sectorName][extra_flag])
                            end)

                            return extra_value
                        end -- end color picker
                        ------------------------------------------------
                        -- DROPDOWN
                        ------------------------------------------------
                        if type == "Dropdown" then
                            Border.Size = Border.Size + UDim2.new(0, 0, 0, 18)

                            value = { Dropdown = default and default.Dropdown or data.options[1] }

                            ------------------------------------------------
                            -- MAIN BUTTON
                            ------------------------------------------------
                            local Drop = library:create("TextButton", {
                                Name = "Dropdown",
                                BackgroundColor3 = Color3.fromRGB(30, 30, 30),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Position = UDim2.new(0, 10, 0, 0),
                                Size = UDim2.new(0, 260, 0, 16),
                                AutoButtonColor = false,
                                Text = "",
                            }, Container)

                            local DropFrame = library:create("Frame", {
                                Name = "DropFrame",
                                BackgroundTransparency = 1,
                                Position = UDim2.new(0, 6, 0, 3),
                                Size = UDim2.new(0, 250, 0, 12),
                            }, Drop)

                            local DropText = library:create("TextLabel", {
                                Name = "DropText",
                                AnchorPoint = Vector2.new(0, 0.5),
                                BackgroundTransparency = 1,
                                Position = UDim2.new(0, 10, 0.5, 0),
                                Size = UDim2.new(0, 230, 0, 10),
                                Font = Enum.Font.Ubuntu,
                                Text = text .. ": " .. value.Dropdown,
                                TextColor3 = Color3.fromRGB(150, 150, 150),
                                TextSize = 14,
                                TextXAlignment = Enum.TextXAlignment.Left,
                            }, DropFrame)

                            local DropArrow = library:create("TextLabel", {
                                AnchorPoint = Vector2.new(1, 0.5),
                                BackgroundTransparency = 1,
                                Position = UDim2.new(1, 0, 0.5, 0),
                                Size = UDim2.new(0, 10, 1, 0),
                                Font = Enum.Font.Ubuntu,
                                Text = ">",
                                TextColor3 = Color3.fromRGB(150, 150, 150),
                                TextSize = 13,
                                Rotation = 90,
                            }, DropFrame)


                            ------------------------------------------------
                            -- DROPDOWN LIST
                            ------------------------------------------------
                            local DropItems = library:create("ScrollingFrame", {
                                Name = "DropItems",
                                Active = true,
                                BackgroundColor3 = Color3.fromRGB(10, 10, 10),
                                BorderColor3 = Color3.fromRGB(30, 30, 30),
                                Position = UDim2.new(0, 0, 0, 18),
                                Size = UDim2.new(0, 260, 0, 0),
                                ScrollBarImageColor3 = Color3.fromRGB(84, 101, 255),
                                ScrollBarThickness = 2,
                                Visible = false,
                                ZIndex = 2,
                            }, Drop)

                            local DropList = library:create("UIListLayout", {
                                SortOrder = Enum.SortOrder.LayoutOrder
                            }, DropItems)

                            local Padding = library:create("UIPadding", {
                                PaddingTop = UDim.new(0, 2),
                                PaddingBottom = UDim.new(0, 2),
                            }, DropItems)


                            ------------------------------------------------
                            -- POPULATE OPTIONS
                            ------------------------------------------------
                            for _, option in ipairs(data.options) do
                                local OptionButton = library:create("TextButton", {
                                    Name = option,
                                    BackgroundTransparency = 1,
                                    Size = UDim2.new(1, 0, 0, 20),
                                    Font = Enum.Font.Ubuntu,
                                    Text = option,
                                    TextColor3 = Color3.fromRGB(150, 150, 150),
                                    TextSize = 14,
                                    ZIndex = 2
                                }, DropItems)

                                ------------------------------------------------
                                -- HOVER ANIMATION
                                ------------------------------------------------
                                OptionButton.MouseEnter:Connect(function()
                                    library:tween(OptionButton,
                                        TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                        { TextColor3 = Color3.fromRGB(255, 255, 255) }
                                    )
                                end)

                                OptionButton.MouseLeave:Connect(function()
                                    if value.Dropdown ~= OptionButton.Name then
                                        library:tween(OptionButton,
                                            TweenInfo.new(.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                                            { TextColor3 = Color3.fromRGB(150, 150, 150) }
                                        )
                                    end
                                end)

                                ------------------------------------------------
                                -- SELECT OPTION
                                ------------------------------------------------
                                OptionButton.MouseButton1Down:Connect(function()
                                    value.Dropdown = option

                                    DropText.Text = text .. ": " .. option
                                    do_callback()

                                    for _, btn in ipairs(DropItems:GetChildren()) do
                                        if btn:IsA("TextButton") then
                                            btn.TextColor3 = Color3.fromRGB(150, 150, 150)
                                        end
                                    end

                                    OptionButton.TextColor3 = Color3.fromRGB(84, 101, 255)

                                    DropItems.Visible = false
                                    Drop.Size = UDim2.new(0, 260, 0, 16)
                                end)
                            end


                            ------------------------------------------------
                            -- OPEN/CLOSE DROPDOWN
                            ------------------------------------------------
                            local open = false

                            Drop.MouseButton1Down:Connect(function()
                                open = not open

                                if open then
                                    DropItems.Visible = true
                                    Drop.Size = UDim2.new(0, 260, 0, math.clamp(DropList.AbsoluteContentSize.Y + 20, 0, 150))
                                else
                                    DropItems.Visible = false
                                    Drop.Size = UDim2.new(0, 260, 0, 16)
                                end
                            end)


                            ------------------------------------------------
                            -- CONFIG SUPPORT
                            ------------------------------------------------
                            function element:set_value(new_value, no_callback)
                                value = new_value or value
                                DropText.Text = text .. ": " .. value.Dropdown

                                for _, child in ipairs(DropItems:GetChildren()) do
                                    if child:IsA("TextButton") then
                                        child.TextColor3 =
                                            (child.Name == value.Dropdown)
                                            and Color3.fromRGB(84, 101, 255)
                                            or  Color3.fromRGB(150, 150, 150)
                                    end
                                end

                                if not no_callback then
                                    do_callback()
                                end
                            end

                            element:set_value(value, true)

                            menu.on_load_cfg:Connect(function()
                                element:set_value(menu.values[tab.tab_num][sectionName][sectorName][flag])
                            end)

                            return element
                        end
                        ------------------------------------------------
                        -- COMBO (MULTI SELECT DROPDOWN)
                        ------------------------------------------------
                        if type == "Combo" then
                            Border.Size = Border.Size + UDim2.new(0, 0, 0, 18)

                            value = { Combo = default and default.Combo or {} }

                            ------------------------------------------------
                            -- MAIN BUTTON
                            ------------------------------------------------
                            local ComboButton = library:create("TextButton", {
                                Name = "Combo",
                                BackgroundColor3 = Color3.fromRGB(30, 30, 30),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Position = UDim2.new(0, 10, 0, 0),
                                Size = UDim2.new(0, 260, 0, 16),
                                AutoButtonColor = false,
                                Text = ""
                            }, Container)

                            local ComboFrame = library:create("Frame", {
                                Name = "ComboFrame",
                                BackgroundTransparency = 1,
                                Position = UDim2.new(0, 6, 0, 3),
                                Size = UDim2.new(0, 250, 0, 12),
                            }, ComboButton)

                            local ComboText = library:create("TextLabel", {
                                Name = "ComboText",
                                AnchorPoint = Vector2.new(0, 0.5),
                                BackgroundTransparency = 1,
                                Position = UDim2.new(0, 10, 0.5, 0),
                                Size = UDim2.new(0, 230, 0, 10),
                                Font = Enum.Font.Ubuntu,
                                Text = text .. ":",
                                TextColor3 = Color3.fromRGB(150, 150, 150),
                                TextSize = 14,
                                TextXAlignment = Enum.TextXAlignment.Left,
                            }, ComboFrame)

                            local ComboArrow = library:create("TextLabel", {
                                AnchorPoint = Vector2.new(1, 0.5),
                                BackgroundTransparency = 1,
                                Position = UDim2.new(1, 0, 0.5, 0),
                                Size = UDim2.new(0, 10, 1, 0),
                                Font = Enum.Font.Ubuntu,
                                Text = ">",
                                TextColor3 = Color3.fromRGB(150, 150, 150),
                                TextSize = 13,
                                Rotation = 90,
                            }, ComboFrame)


                            ------------------------------------------------
                            -- ITEM LIST
                            ------------------------------------------------
                            local ComboItems = library:create("ScrollingFrame", {
                                Name = "ComboItems",
                                Active = true,
                                BackgroundColor3 = Color3.fromRGB(10, 10, 10),
                                BorderColor3 = Color3.fromRGB(30, 30, 30),
                                Position = UDim2.new(0, 0, 0, 18),
                                Size = UDim2.new(0, 260, 0, 0),
                                ScrollBarImageColor3 = Color3.fromRGB(84, 101, 255),
                                ScrollBarThickness = 2,
                                Visible = false,
                                ZIndex = 2,
                            }, ComboButton)

                            local ComboList = library:create("UIListLayout", {
                                SortOrder = Enum.SortOrder.LayoutOrder
                            }, ComboItems)

                            library:create("UIPadding", {
                                PaddingTop = UDim.new(0, 2),
                                PaddingBottom = UDim.new(0, 2),
                            }, ComboItems)


                            ------------------------------------------------
                            -- POPULATE OPTIONS
                            ------------------------------------------------
                            for _, option in ipairs(data.options) do
                                local Item = library:create("TextButton", {
                                    Name = option,
                                    BackgroundTransparency = 1,
                                    Size = UDim2.new(1, 0, 0, 20),
                                    Font = Enum.Font.Ubuntu,
                                    Text = option,
                                    TextColor3 = Color3.fromRGB(150, 150, 150),
                                    TextSize = 14,
                                    ZIndex = 2
                                }, ComboItems)

                                ------------------------------------------------
                                -- HOVER
                                ------------------------------------------------
                                Item.MouseEnter:Connect(function()
                                    library:tween(Item,
                                        TweenInfo.new(.2),
                                        { TextColor3 = Color3.fromRGB(255, 255, 255) }
                                    )
                                end)

                                Item.MouseLeave:Connect(function()
                                    if not table.find(value.Combo, option) then
                                        library:tween(Item,
                                            TweenInfo.new(.2),
                                            { TextColor3 = Color3.fromRGB(150, 150, 150) }
                                        )
                                    end
                                end)


                                ------------------------------------------------
                                -- CLICK SELECT
                                ------------------------------------------------
                                Item.MouseButton1Down:Connect(function()
                                    if table.find(value.Combo, option) then
                                        table.remove(value.Combo, table.find(value.Combo, option))
                                        Item.TextColor3 = Color3.fromRGB(150, 150, 150)
                                    else
                                        table.insert(value.Combo, option)
                                        Item.TextColor3 = Color3.fromRGB(84, 101, 255)
                                    end

                                    do_callback()
                                end)
                            end


                            ------------------------------------------------
                            -- OPEN / CLOSE
                            ------------------------------------------------
                            local open = false

                            ComboButton.MouseButton1Down:Connect(function()
                                open = not open

                                if open then
                                    ComboItems.Visible = true
                                    ComboButton.Size = UDim2.new(0, 260, 0, math.clamp(ComboList.AbsoluteContentSize.Y + 20, 0, 150))
                                else
                                    ComboItems.Visible = false
                                    ComboButton.Size = UDim2.new(0, 260, 0, 16)
                                end
                            end)


                            ------------------------------------------------
                            -- CONFIG SUPPORT
                            ------------------------------------------------
                            function element:set_value(new_value, no_callback)
                                value = new_value or value

                                for _, child in ipairs(ComboItems:GetChildren()) do
                                    if child:IsA("TextButton") then
                                        child.TextColor3 =
                                            table.find(value.Combo, child.Name)
                                            and Color3.fromRGB(84, 101, 255)
                                            or  Color3.fromRGB(150, 150, 150)
                                    end
                                end

                                if not no_callback then
                                    do_callback()
                                end
                            end

                            element:set_value(value, true)

                            menu.on_load_cfg:Connect(function()
                                element:set_value(menu.values[tab.tab_num][sectionName][sectorName][flag])
                            end)

                            return element
                        end
                        ------------------------------------------------
                        -- BUTTON
                        ------------------------------------------------
                        if type == "Button" then
                            Border.Size = Border.Size + UDim2.new(0, 0, 0, 18)

                            value = {} -- buttons don't need stored values

                            local Button = library:create("TextButton", {
                                Name = "Button",
                                BackgroundColor3 = Color3.fromRGB(30, 30, 30),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Position = UDim2.new(0, 10, 0, 0),
                                Size = UDim2.new(0, 260, 0, 16),
                                AutoButtonColor = false,
                                Font = Enum.Font.Ubuntu,
                                Text = text,
                                TextColor3 = Color3.fromRGB(150, 150, 150),
                                TextSize = 14,
                            }, Container)

                            ------------------------------------------------
                            -- HOVER
                            ------------------------------------------------
                            Button.MouseEnter:Connect(function()
                                library:tween(Button,
                                    TweenInfo.new(.2),
                                    { TextColor3 = Color3.fromRGB(255, 255, 255) }
                                )
                            end)

                            Button.MouseLeave:Connect(function()
                                library:tween(Button,
                                    TweenInfo.new(.2),
                                    { TextColor3 = Color3.fromRGB(150, 150, 150) }
                                )
                            end)

                            ------------------------------------------------
                            -- CLICK
                            ------------------------------------------------
                            Button.MouseButton1Down:Connect(function()
                                callback()
                            end)

                            return element
                        end


                        ------------------------------------------------
                        -- TEXTBOX
                        ------------------------------------------------
                        if type == "Textbox" then
                            Border.Size = Border.Size + UDim2.new(0, 0, 0, 18)

                            value = {
                                Textbox = default and default.Textbox or ""
                            }

                            ------------------------------------------------
                            -- BOX
                            ------------------------------------------------
                            local Box = library:create("TextBox", {
                                Name = "Textbox",
                                BackgroundColor3 = Color3.fromRGB(30, 30, 30),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Position = UDim2.new(0, 10, 0, 0),
                                Size = UDim2.new(0, 260, 0, 16),
                                ClearTextOnFocus = false,
                                Font = Enum.Font.Ubuntu,
                                PlaceholderText = text,
                                Text = default and default.Textbox or "",
                                TextColor3 = Color3.fromRGB(150, 150, 150),
                                TextSize = 14,
                                TextXAlignment = Enum.TextXAlignment.Left,
                            }, Container)


                            ------------------------------------------------
                            -- CALLBACK
                            ------------------------------------------------
                            Box.FocusLost:Connect(function()
                                value.Textbox = Box.Text
                                do_callback()
                            end)

                            ------------------------------------------------
                            -- CONFIG SUPPORT
                            ------------------------------------------------
                            function element:set_value(new_value, no_callback)
                                value = new_value or value
                                Box.Text = value.Textbox

                                if not no_callback then
                                    do_callback()
                                end
                            end

                            element:set_value(value, true)

                            menu.on_load_cfg:Connect(function()
                                element:set_value(menu.values[tab.tab_num][sectionName][sectorName][flag])
                            end)

                            return element
                        end
                        ------------------------------------------------
                        -- SCROLL LIST
                        ------------------------------------------------
                        if type == "Scroll" then
                            Border.Size = Border.Size + UDim2.new(0, 0, 0, 100)

                            value = {
                                Scroll = default and default.Scroll or ""
                            }

                            local ScrollFrame = library:create("ScrollingFrame", {
                                Name = "Scroll",
                                Active = true,
                                BackgroundColor3 = Color3.fromRGB(10, 10, 10),
                                BorderColor3 = Color3.fromRGB(30, 30, 30),
                                Position = UDim2.new(0, 10, 0, 0),
                                Size = UDim2.new(0, 260, 0, 90),
                                ScrollBarThickness = 2,
                                ScrollBarImageColor3 = Color3.fromRGB(84, 101, 255)
                            }, Container)

                            local List = library:create("UIListLayout", {
                                SortOrder = Enum.SortOrder.LayoutOrder
                            }, ScrollFrame)

                            ------------------------------------------------
                            -- POPULATE
                            ------------------------------------------------
                            for _, option in ipairs(data.options) do
                                local Item = library:create("TextLabel", {
                                    BackgroundTransparency = 1,
                                    Size = UDim2.new(1, -5, 0, 20),
                                    Font = Enum.Font.Ubuntu,
                                    Text = option,
                                    TextColor3 = Color3.fromRGB(150, 150, 150),
                                    TextSize = 14
                                }, ScrollFrame)
                            end

                            return element
                        end


                        ------------------------------------------------
                        -- SLIDER
                        ------------------------------------------------
                        if type == "Slider" then
                            Border.Size = Border.Size + UDim2.new(0, 0, 0, 30)

                            value = {
                                Slider = default and default.Slider or data.min
                            }

                            ------------------------------------------------
                            -- SLIDER FRAME
                            ------------------------------------------------
                            local Slider = library:create("Frame", {
                                Name = "Slider",
                                BackgroundTransparency = 1,
                                Position = UDim2.new(0, 10, 0, 0),
                                Size = UDim2.new(0, 260, 0, 25)
                            }, Container)

                            local SliderText = library:create("TextLabel", {
                                BackgroundTransparency = 1,
                                Position = UDim2.new(0, 0, 0, 0),
                                Size = UDim2.new(1, 0, 0, 10),
                                Font = Enum.Font.Ubuntu,
                                Text = text .. ": " .. value.Slider,
                                TextColor3 = Color3.fromRGB(150, 150, 150),
                                TextSize = 14,
                                TextXAlignment = Enum.TextXAlignment.Left
                            }, Slider)

                            local SlideBar = library:create("Frame", {
                                BackgroundColor3 = Color3.fromRGB(30, 30, 30),
                                BorderColor3 = Color3.fromRGB(0, 0, 0),
                                Position = UDim2.new(0, 0, 0, 15),
                                Size = UDim2.new(1, 0, 0, 8)
                            }, Slider)

                            local Fill = library:create("Frame", {
                                BackgroundColor3 = Color3.fromRGB(84, 101, 255),
                                BorderSizePixel = 0,
                                Size = UDim2.new((value.Slider - data.min) / (data.max - data.min), 0, 1, 0)
                            }, SlideBar)

                            ------------------------------------------------
                            -- DRAG LOGIC
                            ------------------------------------------------
                            local dragging = false

                            local function set_slider(x)
                                local pct = math.clamp((x - SlideBar.AbsolutePosition.X) / SlideBar.AbsoluteSize.X, 0, 1)
                                local new_value = math.floor((data.min + (data.max - data.min) * pct) / (data.increment or 1)) * (data.increment or 1)

                                value.Slider = new_value
                                Fill.Size = UDim2.new(pct, 0, 1, 0)

                                SliderText.Text = text .. ": " .. new_value
                                do_callback()
                            end

                            SlideBar.InputBegan:Connect(function(input)
                                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                                    dragging = true
                                    set_slider(UserInputService:GetMouseLocation().X)
                                end
                            end)

                            UserInputService.InputEnded:Connect(function(input)
                                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                                    dragging = false
                                end
                            end)

                            RunService.RenderStepped:Connect(function()
                                if dragging then
                                    set_slider(UserInputService:GetMouseLocation().X)
                                end
                            end)


                            ------------------------------------------------
                            -- CONFIG SUPPORT
                            ------------------------------------------------
                            function element:set_value(new_value, no_callback)
                                value = new_value or value

                                local pct = (value.Slider - data.min) / (data.max - data.min)
                                Fill.Size = UDim2.new(pct, 0, 1, 0)

                                SliderText.Text = text .. ": " .. value.Slider

                                if not no_callback then
                                    do_callback()
                                end
                            end

                            element:set_value(value, true)

                            menu.on_load_cfg:Connect(function()
                                element:set_value(menu.values[tab.tab_num][sectionName][sectorName][flag])
                            end)

                            return element
                        end


                        ------------------------------------------------
                        -- END OF ELEMENT FACTORY
                        ------------------------------------------------
                        return element
                    end -- end sector.element
                    ------------------------------------------------
                    -- END OF SECTOR
                    ------------------------------------------------
                    return sector
                end -- sector.new_sector


                ------------------------------------------------
                -- RETURN SECTION
                ------------------------------------------------
                return section
            end -- tab.new_section


            ------------------------------------------------
            -- RETURN TAB
            ------------------------------------------------
            return tab
        end -- menu.new_tab


        ------------------------------------------------
        -- FINAL MENU RETURN
        ------------------------------------------------
        return menu
    end


    ------------------------------------------------
    -- RETURN LIBRARY
    ------------------------------------------------
    return library
